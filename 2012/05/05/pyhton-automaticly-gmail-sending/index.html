<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> python实现gmail自动收发邮件 · r14o</title><meta name="description" content="python实现gmail自动收发邮件 - Ruogu Liu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://rogers140.github.io/atom.xml" title="r14o"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://www.linkedin.com/in/ruogu-liu-8a120456" target="_blank" class="nav-list-link">LINKEDIN</a></li><li class="nav-list-item"><a href="https://github.com/rogers140" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">python实现gmail自动收发邮件</h1><div class="post-info">May 5, 2012</div><div class="post-content"><p>因为软工项目可能用到自动发邮件这个功能，所以先用python实现了一下，先不说别的，上代码。<br><a id="more"></a><br>EmailSender.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> smtplib</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> email.mime.text</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">GmailSender</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,username,password)</span>:</span></div><div class="line">        self.mail_username=username</div><div class="line">        self.mail_password=password</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sendEmail</span><span class="params">(self,to_addresslist,subject,content)</span>:</span></div><div class="line">        HOST = <span class="string">'smtp.gmail.com'</span></div><div class="line">    PORT = <span class="number">25</span></div><div class="line">    smtp = smtplib.SMTP()</div><div class="line">    <span class="keyword">print</span> <span class="string">'connecting ...'</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        <span class="keyword">print</span> smtp.connect(HOST,PORT)</div><div class="line">    <span class="keyword">except</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'CONNECT ERROR '</span></div><div class="line">        smtp.starttls()</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">print</span> <span class="string">'Loginning...'</span></div><div class="line">            smtp.login(self.mail_username,self.mail_password)</div><div class="line">        <span class="keyword">except</span>:</div><div class="line">            <span class="keyword">print</span> <span class="string">'Login Error'</span></div><div class="line">        message=email.mime.text.MIMEText(<span class="string">""</span>+content)</div><div class="line">        message[<span class="string">'From'</span>]=self.mail_username</div><div class="line">        message[<span class="string">'To'</span>]=<span class="string">';'</span>.join(to_addresslist)</div><div class="line">        message[<span class="string">'subject'</span>]=<span class="string">""</span>+subject</div><div class="line">        <span class="keyword">print</span> <span class="string">'You message is '</span>+message.as_string()</div><div class="line">        smtp.sendmail(self.mail_username,to_addresslist,message.as_string())</div><div class="line">        smtp.quit()</div></pre></td></tr></table></figure></p>
<p>接下来就是main.py了，执行发邮件的命令<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> EmailSender <span class="keyword">import</span>*</div><div class="line">gs=GmailSender(<span class="string">'***@gmail.com'</span>,<span class="string">'***'</span>)</div><div class="line">to_list=(<span class="string">'***@qq.com'</span>,)</div><div class="line">subject=<span class="string">"haha"</span></div><div class="line">content=<span class="string">"haha"</span></div><div class="line">gs.sendEmail(to_list,subject,content)</div></pre></td></tr></table></figure></p>
<p>但是想查询自己的未读邮件怎么办呢？这里要注意一个问题，smtp协议是发送和接收的协议，pop和imap是查询邮件的协议，有的邮箱服务提供商不一定都支持pop和imap，但至少支持一个，现在一般都是imap。若是和我一样用的Gmail，那么最好是用imap协议查询，使用pop需要自己改很多东西。</p>
<p>支持Gmail的代码如下:<br>EmailChecker.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> imaplib</div><div class="line"><span class="keyword">import</span> email</div><div class="line"><span class="keyword">import</span> string</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">GmailChecker</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,username,password)</span>:</span></div><div class="line">        self.username=username</div><div class="line">        self.password=password</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkmail</span><span class="params">(self)</span>:</span></div><div class="line">        server=imaplib.IMAP4_SSL(<span class="string">'imap.gmail.com'</span>,<span class="string">'993'</span>)</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">print</span> <span class="string">'logining...'</span></div><div class="line">            server.login(self.username,self.password)</div><div class="line">            <span class="keyword">print</span> <span class="string">'###login success###'</span></div><div class="line">        <span class="keyword">except</span>:</div><div class="line">            <span class="keyword">print</span> <span class="string">'login fail'</span></div><div class="line">            server.close()</div><div class="line">        result,message=server.select()</div><div class="line">        typ,data=server.search(<span class="keyword">None</span>,<span class="string">'unseen'</span>)</div><div class="line">        <span class="keyword">print</span> <span class="string">''</span>+data[<span class="number">0</span>]</div><div class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> string.split(data[<span class="number">0</span>]):</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                typ,dat=server.fetch(num,<span class="string">'(RFC822)'</span>)</div><div class="line">                <span class="comment">#fetch方法(emailID,format)</span></div><div class="line">                msg=email.message_from_string(dat[<span class="number">0</span>][<span class="number">1</span>])</div><div class="line">                <span class="comment">#dat是一个list，大小为2；</span></div><div class="line">                <span class="comment">#dat[0]也是一个list,dat[0][0]是邮件头，定义一些格式啊什么的，dat[0][1]是邮件主体；</span></div><div class="line">                <span class="comment">#dat[1]是一个')'</span></div><div class="line">                <span class="keyword">print</span> msg[<span class="string">'From'</span>]</div><div class="line">                <span class="keyword">print</span> msg[<span class="string">'subject'</span>]</div><div class="line">                <span class="keyword">print</span> msg[<span class="string">'Date'</span>]</div><div class="line">                <span class="keyword">print</span> <span class="string">'____________________________________'</span></div><div class="line">            <span class="keyword">except</span> Exception, e:</div><div class="line">                <span class="keyword">print</span> e</div><div class="line">gc=GmailChecker(<span class="string">'***@gmail.com'</span>,<span class="string">'*********'</span>)</div><div class="line">gc.checkmail()</div></pre></td></tr></table></figure></p>
</div></article></div></section><footer><div class="paginator"><a href="/2013/01/21/move-to-ec2/" class="prev">PREV</a><a href="/2012/05/05/Jquery-lazyload-reminder/" class="next">NEXT</a></div><div class="copyright"><p>© 2012 - 2016 <a href="https://rogers140.github.io">Ruogu Liu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>